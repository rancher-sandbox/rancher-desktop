# Signing releases

Normally, we build artifacts via GitHub Actions as zip files, which can then be
signed offline.  This is necessary as the relevant certificates are not
available online during CI.

## Windows

On Windows, we can sign a zip build using the `npm run sign` command:

1. Download the archive from GitHub.

   **Note** The archive will be a zip within a zip.  Extract one level to get
   the file as generated by electron-builder.

2. Run the signing tool:

    ```powershell
    npm run sign -- 'Path\To\Archive.zip'
    ```

    Rememeber to set `CSC_LINK` and `CSC_KEY_PASSWORD` as appropriate so that
    the correct certificate is used; see [electron-builder documentation] for
    details.

    [electron-builder documentation]: https://www.electron.build/code-signing

3. The built installer can be found under `dist/Rancher Desktop * Setup.exe` as
    normal.

### Generating a Self-Signed Certificate

For development, it can be very helpful to have a self-signed certificate for
testing purposes.  This will not be recognized by Windows (which will treat it
as if it was never signed), but will show up in the Digital Signatures tab in
the file properties in Explorer.  This can be generated via a PowerShell
command:

```powershell
New-SelfSignedCertificate `
    -Type Custom `
    -Subject "CN=Rancher-Sandbox, C=CA" `
    -KeyUsage DigitalSignature `
    -CertStoreLocation Cert:\CurrentUser\My `
    -FriendlyName "Rancher-Sandbox Code Signing" `
    -TextExtension @("2.5.29.37={text}1.3.6.1.5.5.7.3.3", "2.5.29.19={text}") `
    | Export-PfxCertificate -FilePath $Env:Tmp\cert.pfx `
    -Password (ConvertTo-SecureString -String "qwerty" -Force -AsPlainText)
```

This generates a certificate in `%TMP%\cert.pfx` with the password `qwerty`.
See also related documentation for
[signing for MSIX](https://docs.microsoft.com/en-us/windows/msix/package/create-certificate-package-signing).
